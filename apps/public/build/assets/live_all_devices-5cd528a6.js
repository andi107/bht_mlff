import{_ as v}from"./leaflet.rotatedMarker-71d1d069.js";import"./leaflet-svg-shape-markers-8f7f1e58.js";import"./_commonjsHelpers-28e086c5.js";const p=window.burl,w=window.sio,b="/assets/images/leaflet/toll_gate.png";var r=L.map("devicesmap",{minZoom:5,attributionControl:!1,fullscreenControl:!0}).setView([.33995192349439596,120.3733680354565],5),s=new L.FeatureGroup,n={},m=function(e){return L.icon({iconUrl:e,iconSize:window.c_marker_front_cfg[0],iconAnchor:window.c_marker_front_cfg[1],popupAnchor:window.c_marker_front_cfg[2]})},x=function(){return Math.floor(Math.random()*16777215).toString(16)},_=[],u,g=[],h=[],y,k=L.tileLayer(window.mapLayer,{attribution:""});k.addTo(r);var G=function(e){return`<h3 class="h6 d-block text-uppercase font-weight-bold">${e.ftdevice_name}</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">Last Update</div><div class="col-7 pl-4">${window.dtHumanParse(e.created_at)}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle ID</div><div class="col-7 pl-4">${e.ftasset_id}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle Name</div><div class="col-7 pl-4">${e.ftasset_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark"></div>`};$.get(p+"/devtools/monitor/js/devices",function(e){$.each(e.data.data,function(o,t){var a=new v([t.fflat,t.fflon],{draggable:!1,riseOnHover:!0,icon:m(window.c_marker_front)});a.bindTooltip(t.ftasset_id).openTooltip();var i=L.popup().setContent(G(t));a.bindPopup(i,{className:"custom-popup"}).openPopup(),n[t.ftdevice_id]=a,n[t.ftdevice_id].__pathColor=`#${x()}`,a.addTo(r),s.addLayer(a),s.addTo(r)}),e.data.data.length!=0?r.fitBounds(s.getBounds()):console.log("No Data"),A()});function A(){w.on("trx_device_data_rcv",function(e){var o=JSON.parse(e);if(typeof n[o.id]<"u"){var t={lat:o.lat,lng:o.lon},a=new L.Polyline([n[o.id]._latlng,t],{color:n[o.id].__pathColor,weight:5,opacity:.5,smoothFactor:1});a.addTo(r),n[o.id].slideTo([o.lat,o.lon],{duration:5e3,keepAtCenter:!1});var i=L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],popupAnchor:window.c_marker_top_cfg[2]});n[o.id].setIcon(i),n[o.id].setRotationAngle(o.direction),n[o.id].setRotationOrigin("center center"),n[o.id]._latlng=t,setTimeout(function(){n[o.id].setIcon(m(window.c_marker_front)),n[o.id].setRotationAngle(0)},3e5)}})}$.get(p+"/info/js/gate/zone",function(e){$.each(e.data,function(o,t){_.push({type:"Feature",properties:{created_at:t.created_at,fflat:t.fflat,fflon:t.fflon,fnpayment_type:t.fnpayment_type,ftdescription:t.ftdescription,ftname:t.ftname,ftsection:t.ftsection,id:t.id},geometry:{type:"Point",coordinates:[parseFloat(t.fflon),parseFloat(t.fflat)]}}),g.push({type:"Feature",properties:{fntype:t.fntype},geometry:{type:"Polygon",coordinates:[t.polygon]}})}),e.data.length!=0?(F(r),C(r)):console.log("No Data")});$.get(`${p}/info/js/tollsectionpoint`,function(e){$.each(e.data,function(o,t){console.log(t.fflon,t.fflat),h.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[parseFloat(t.fflon),parseFloat(t.fflat)]}})}),e.data.length!=0&&P(r)});function F(e){var o=new L.featureGroup([]),t={type:"FeatureCollection",name:"relay",features:_};function a(f,c){var l=f.properties,d="n/a";l.fnpayment_type===1?d="Open":l.fnpayment_type===2&&(d="Close"),c.bindPopup(`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${l.ftname}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${l.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">PAYMENT TYPE</div><div class="col-7 pl-4">${d}</div></div>`,{maxHeight:400}),c.bindTooltip(l.ftname)}e.createPane("pane_Gate"),e.getPane("pane_Gate").style.zIndex=402,e.getPane("pane_Gate").style["mix-blend-mode"]="normal";var i=new L.geoJson(t,{attribution:"",interactive:!0,dataVar:"jGate",layerName:"lGate",pane:"pane_Gate",onEachFeature:a,pointToLayer:function(f,c){return L.marker(c,{icon:L.icon({iconUrl:b,iconSize:[30,30],iconAnchor:[16,25],popupAnchor:[0,-15]})})}});o.addLayer(i),e.addLayer(i),e.fitBounds(o.getBounds())}function C(e){var o={type:"FeatureCollection",name:"polyGates",features:g};function t(a){return a.properties.fntype===1?{pane:"pane_polyGates",opacity:1,color:"#00FFCA",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:2,fillOpacity:1,interactive:!0}:{pane:"pane_polyGates",opacity:1,color:"#ED2B2A",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:2,fillOpacity:1,interactive:!0}}e.createPane("pane_polyGates"),e.getPane("pane_polyGates").style.zIndex=401,e.getPane("pane_polyGates").style["mix-blend-mode"]="normal",u=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"json_polyGates",layerName:"layer_polyGates",pane:"pane_polyGates",style:t,pointToLayer:function(a,i){return window._newMarker(i,{icon:L.icon({iconUrl:window.gateUrl,iconSize:[30,30],iconAnchor:[8,25],popupAnchor:[0,-20]})},a.properties.gate_name,`<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">GATE NAME</div><div class="col-7 pl-4">${a.properties.gate_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SECTION</div><div class="col-7 pl-4">${a.properties.ftsection}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DECLARE</div><div class="col-7 pl-4">${a.properties.ftdeclaration_type}</div></div>`)}}),e.addLayer(u)}function P(e){var o={type:"FeatureCollection",name:"section",features:h};function t(){return{pane:"pane_Relay",shape:"circle",radius:4,opacity:1,color:"#CF0A0A",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:"#FF0032",interactive:!0}}e.createPane("pane_Section"),e.getPane("pane_Section").style.zIndex=402,e.getPane("pane_Section").style["mix-blend-mode"]="normal",y=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"jSection",layerName:"lSection",pane:"pane_Section",pointToLayer:function(a,i){return L.shapeMarker(i,t())}}),e.addLayer(y)}
