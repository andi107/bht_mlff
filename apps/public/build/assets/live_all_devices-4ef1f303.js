import{_ as l}from"./leaflet.rotatedMarker-71d1d069.js";import"./_commonjsHelpers-28e086c5.js";const s=window.burl,p=window.sio;var a=L.map("devicesmap",{minZoom:5,attributionControl:!1,fullscreenControl:!0}).setView([.33995192349439596,120.3733680354565],5),d=new L.FeatureGroup,t={},c=function(e){return L.icon({iconUrl:e,iconSize:window.c_marker_front_cfg[0],iconAnchor:window.c_marker_front_cfg[1],popupAnchor:window.c_marker_front_cfg[2]})},m=function(){return Math.floor(Math.random()*16777215).toString(16)},f=L.tileLayer(window.mapLayer,{attribution:""});f.addTo(a);var _=function(e){return`<h3 class="h6 d-block text-uppercase font-weight-bold">${e.ftdevice_name}</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">Last Update</div><div class="col-7 pl-4">${window.dtHumanParse(e.created_at)}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle ID</div><div class="col-7 pl-4">${e.ftasset_id}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle Name</div><div class="col-7 pl-4">${e.ftasset_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark"></div>`};$.get(s+"/devtools/monitor/js/devices",function(e){$.each(e.data.data,function(o,r){var i=new l([r.fflat,r.fflon],{draggable:!1,riseOnHover:!0,icon:c(window.c_marker_front)});i.bindTooltip(r.ftasset_id).openTooltip();var n=L.popup().setContent(_(r));i.bindPopup(n,{className:"custom-popup"}).openPopup(),t[r.ftdevice_id]=i,t[r.ftdevice_id].__pathColor=`#${m()}`,i.addTo(a),d.addLayer(i),d.addTo(a)}),e.data.data.length!=0?a.fitBounds(d.getBounds()):console.log("No Data"),u()});function u(){p.on("trx_device_data_rcv",function(e){var o=JSON.parse(e);if(typeof t[o.id]<"u"){var r={lat:o.lat,lng:o.lon},i=new L.Polyline([t[o.id]._latlng,r],{color:t[o.id].__pathColor,weight:5,opacity:.5,smoothFactor:1});i.addTo(a),t[o.id].slideTo([o.lat,o.lon],{duration:5e3,keepAtCenter:!1});var n=L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],popupAnchor:window.c_marker_top_cfg[2]});t[o.id].setIcon(n),t[o.id].setRotationAngle(o.direction),t[o.id].setRotationOrigin("center center"),t[o.id]._latlng=r,setTimeout(function(){t[o.id].setIcon(c(window.c_marker_front)),t[o.id].setRotationAngle(0)},3e5)}})}
