import{_ as x}from"./leaflet.rotatedMarker-71d1d069.js";import"./leaflet-svg-shape-markers-8f7f1e58.js";import"./_commonjsHelpers-28e086c5.js";const k=window.burl;var R=$("#tbllogsdet").DataTable({dom:"Bfrtip",buttons:[{extend:"copy"},{extend:"pdf"},{extend:"print"},{extend:"excel"}],scrollX:!0,order:[[0,"desc"]]});$("#tbllogsdet").width("100%");var _,g,b,t=L.map("trackingmap",{minZoom:5,fullscreenControl:!0,attributionControl:!1}).setView([.33995192349439596,120.3733680354565],5),T=L.tileLayer(window.mapLayer);T.addTo(t);var d,u,n=[],m=[];$("#formMapTrack").submit(function(o){o.preventDefault(),_=$("input[name=device_id]").val(),g=$("input[name=txtdtfrom]").val(),b=$("input[name=txtdtto]").val(),n=[],m=[],d&&(t.removeLayer(d),t.removeLayer(u)),f&&clearInterval(f),R.clear().draw(),$.get(k+`/tracking/detail/js/map?did=${_}&from=${g}&to=${b}&humanTz=${window.dtHumanName()}`,function(a){$.each(a.relay.data,function(l,e){n.push({type:"Feature",properties:{created_at:e.created_at,ffaccuracy_cep:e.ffaccuracy_cep,ffaltitude:e.ffaltitude,ffbattery:e.ffbattery,ffdirection:e.ffdirection,fflat:e.fflat,fflon:e.fflon,ffspeed:e.ffspeed},geometry:{type:"Point",coordinates:[parseFloat(e.fflon),parseFloat(e.fflat)]}}),m.push([parseFloat(e.fflon),parseFloat(e.fflat)])}),a.relay.data.length!=0?(F(),I(),h()):toastr.info("Vehicle tracking not found.","Information")})});function F(){var o=new L.featureGroup([]),a={type:"FeatureCollection",name:"relay",features:n};function l(){return{pane:"pane_Relay",shape:"circle",radius:4,opacity:1,color:"#CF0A0A",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:"#FF0032",interactive:!0}}function e(v,c){var r=v.properties,s="n/a";y(parseInt(r.fnsignal),0,10)?s="Poor":y(parseInt(r.fnsignal),11,20)?s="Good":y(parseInt(r.fnsignal),21,31)&&(s="Excelent");var w='<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">DATE TIME</div><div class="col-7 pl-4">'+window.dtHumanParse(r.created_at)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ALT (Meters)</div><div class="col-7 pl-4">'+parseFloat(parseFloat(r.ffaltitude)/3.2808).toFixed(2)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SPEED</div><div class="col-7 pl-4">'+r.ffspeed+'Km/h</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ACCURACY (CEP)</div><div class="col-7 pl-4">'+r.ffaccuracy_cep+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SIGNAL</div><div class="col-7 pl-4">'+r.fnsignal+" ("+s+')</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DIRECTION</div><div class="col-7 pl-4">'+r.ffdirection+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">COORDINATE</div><div class="col-7 pl-4">'+r.fflat.toString()+", "+r.fflon.toString()+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SATTELITE</div><div class="col-7 pl-4">'+r.fnsattelite+"</div></div>";c.bindPopup(w,{maxHeight:400}),c.bindTooltip(window.dtHumanParse(r.created_at)).openTooltip()}t.createPane("pane_Relay"),t.getPane("pane_Relay").style.zIndex=402,t.getPane("pane_Relay").style["mix-blend-mode"]="normal",d=new L.geoJson(a,{attribution:"",interactive:!0,dataVar:"jRelay",layerName:"lRelay",pane:"pane_Relay",onEachFeature:e,pointToLayer:function(v,c){return L.shapeMarker(c,l())}}),o.addLayer(d),t.addLayer(d),t.fitBounds(o.getBounds())}function I(){var o={type:"FeatureCollection",name:"line_relay",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m}}]};function a(l){return{pane:"pane_line_relay",opacity:1,color:"#FF0032",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:0,interactive:!0}}t.createPane("pane_line_relay"),t.getPane("pane_line_relay").style.zIndex=401,t.getPane("pane_line_relay").style["mix-blend-mode"]="normal",u=new L.geoJson(o,{attribution:"",interactive:!0,dataVar:"json_line_relay",layerName:"layer_line_relay",pane:"pane_line_relay",style:a}),t.addLayer(u)}function y(o,a,l){return o>=a&&o<=l}var i,p=0,f;function h(){p=0;var o=n[0];i&&t.removeLayer(i),i=new x([o.geometry.coordinates[1],o.geometry.coordinates[0]],{draggable:!1,riseOnHover:!0,icon:L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[0,-15]})}).addTo(t),f=setInterval(function(){var a=n[p];i.slideTo([a.geometry.coordinates[1],a.geometry.coordinates[0]],{duration:1e3,keepAtCenter:!1}),i.setIcon(L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[16,0]})),i.setRotationAngle(a.properties.ffdirection),i.setRotationOrigin("center center"),i.bindTooltip(`Speed: ${a.properties.ffspeed} Km/h`,{position:"bottom"}),i.openTooltip(),p++,p===n.length&&(clearInterval(f),h())},1e3)}
