const f=location.protocol+"//"+window.location.host,b=f+"/assets/images/leaflet/marker-icon.png",w=f+"/assets/images/leaflet/marker-shadow.png";var p=$("#tbllogsdet").DataTable({dom:"Bfrtip",buttons:[{extend:"copy"},{extend:"pdf"},{extend:"print"},{extend:"excel"}],scrollX:!0,order:[[0,"asc"]],columnDefs:[{target:0,visible:!1,searchable:!1}]});$("#tbllogsdet").width("100%");var m,u,g,r=L.map("trackingmap",{minZoom:5,fullscreenControl:!0,attributionControl:!1}).setView([.33995192349439596,120.3733680354565],5),d={},n=new L.FeatureGroup,l=[],s,x=L.tileLayer(window.mapLayer);x.addTo(r);function k(t,a=null,o=null,e=null){var i;if(a?i=L.marker(t,a):i=L.marker(t),e){var v=L.popup().setContent(e);i.bindPopup(v).openPopup()}if(o){var h=L.tooltip().setContent(o);i.bindTooltip(h).openTooltip()}return i.addTo(r),i}function y(t){s=new L.Polyline(t,{color:"red",weight:3,opacity:.5,smoothFactor:1}),s.addTo(r)}$("#formMapTrack").submit(function(t){t.preventDefault(),m=$("input[name=device_id]").val(),u=$("input[name=txtdtfrom]").val(),g=$("input[name=txtdtto]").val();for(const[a,o]of Object.entries(d))r.removeLayer(d[a]),delete d[a];l.forEach(function(a){delete l[a]}),s&&r.removeLayer(s),l=null,l=[],p.clear().draw(),$.get(f+"/tracking/detail/js/map?did="+m+"&from="+u+"&to="+g,function(a){$.each(a.relay.data,function(o,e){d[e.id]=k({lat:e.fflat,lng:e.fflon},{icon:L.icon({iconUrl:b,shadowUrl:w,iconAnchor:[17,37],shadowAnchor:[17,37],popupAnchor:[0,-15]})},e.created_at,T(e)),n.addLayer(d[e.id]),n.addTo(r),l.push({lat:e.fflat,lng:e.fflon}),e.alt&&parseFloat(parseFloat(e.alt)/3.2808).toFixed(2),p.row.add([e.id,e.created_at,e.fflat,e.fflon,e.ffaccuracy_cep,e.ffdirection,e.ffspeed,e.ffaltitude]).draw(!0)}),a.relay.data.length!=0?(r.fitBounds(n.getBounds()),y(l)):console.log("No Data")})});$(".datepicker").datetimepicker({format:"YYYY-MM-DD HH:mm:ss"});function c(t,a,o){return t>=a&&t<=o}var T=function(t){var a="n/a";return c(parseInt(t.fnsignal),0,10)?a="Poor":c(parseInt(t.fnsignal),11,20)?a="Good":c(parseInt(t.fnsignal),21,31)&&(a="Excelent"),'<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">DATE TIME</div><div class="col-7 pl-4">'+t.created_at+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ALT (Meters)</div><div class="col-7 pl-4">'+parseFloat(parseFloat(t.ffaltitude)/3.2808).toFixed(2)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SPEED</div><div class="col-7 pl-4">'+t.ffspeed+'Km/h</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ACCURACY (CEP)</div><div class="col-7 pl-4">'+t.ffaccuracy_cep+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SIGNAL</div><div class="col-7 pl-4">'+t.fnsignal+" ("+a+')</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DIRECTION</div><div class="col-7 pl-4">'+t.ffdirection+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">COORDINATE</div><div class="col-7 pl-4">'+t.fflat.toString()+", "+t.fflon.toString()+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SATTELITE</div><div class="col-7 pl-4">'+t.fnsattelite+"</div></div>"};
