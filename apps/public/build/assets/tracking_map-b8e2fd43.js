const f=location.protocol+"//"+window.location.host,b=f+"/assets/images/leaflet/marker-icon.png",x=f+"/assets/images/leaflet/marker-shadow.png";var p=$("#tbllogsdet").DataTable({dom:"Bfrtip",buttons:[{extend:"copy"},{extend:"pdf"},{extend:"print"},{extend:"excel"}],scrollX:!0,order:[[0,"asc"]],columnDefs:[{target:0,visible:!1,searchable:!1}]});$("#tbllogsdet").width("100%");var m,u,g,a=L.map("trackingmap",{minZoom:5,fullscreenControl:!0,attributionControl:!1}).setView([.33995192349439596,120.3733680354565],5),d={},n=new L.FeatureGroup,i=[],s,w=L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png");w.addTo(a);function k(t,o=null,r=null,e=null){var l;if(o?l=L.marker(t,o):l=L.marker(t),e){var h=L.popup().setContent(e);l.bindPopup(h).openPopup()}if(r){var v=L.tooltip().setContent(r);l.bindTooltip(v).openTooltip()}return l.addTo(a),l}function y(t){s=new L.Polyline(t,{color:"red",weight:3,opacity:.5,smoothFactor:1}),s.addTo(a)}$("#formMapTrack").submit(function(t){t.preventDefault(),m=$("input[name=device_id]").val(),u=$("input[name=txtdtfrom]").val(),g=$("input[name=txtdtto]").val();for(const[o,r]of Object.entries(d))a.removeLayer(d[o]),delete d[o];i.forEach(function(o){delete i[o]}),s&&a.removeLayer(s),i=null,i=[],p.clear().draw(),$.get(f+"/tracking/detail/js/map?did="+m+"&from="+u+"&to="+g,function(o){console.log(o),$.each(o.relay.data,function(r,e){d[e.id]=k({lat:e.fflat,lng:e.fflon},{icon:L.icon({iconUrl:b,shadowUrl:x,iconAnchor:[17,37],shadowAnchor:[17,37],popupAnchor:[0,-15]})},e.created_at,T(e)),n.addLayer(d[e.id]),n.addTo(a),i.push({lat:e.fflat,lng:e.fflon}),e.alt&&parseFloat(parseFloat(e.alt)/3.2808).toFixed(2),p.row.add([e.id,e.created_at,e.fflat,e.fflon,e.ffaccuracy_cep,e.ffdirection,e.ffspeed,e.ffaltitude]).draw(!0)}),o.relay.data.length!=0?(a.fitBounds(n.getBounds()),y(i)):console.log("No Data")})});$(".datepicker").datetimepicker({format:"YYYY-MM-DD HH:mm:ss"});function c(t,o,r){return t>=o&&t<=r}var T=function(t){var o="n/a";return c(parseInt(t.fnsignal),0,10)?o="Poor":c(parseInt(t.fnsignal),11,20)?o="Good":c(parseInt(t.fnsignal),21,31)&&(o="Excelent"),console.log(t,o),'<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">DATE TIME</div><div class="col-7 pl-4">'+t.created_at+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ALT (Meters)</div><div class="col-7 pl-4">'+parseFloat(parseFloat(t.ffaltitude)/3.2808).toFixed(2)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SPEED</div><div class="col-7 pl-4">'+t.ffspeed+'Km/h</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ACCURACY (CEP)</div><div class="col-7 pl-4">'+t.ffaccuracy_cep+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SIGNAL</div><div class="col-7 pl-4">'+t.fnsignal+" ("+o+')</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DIRECTION</div><div class="col-7 pl-4">'+t.ffdirection+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">COORDINATE</div><div class="col-7 pl-4">'+t.fflat.toString()+", "+t.fflon.toString()+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SATTELITE</div><div class="col-7 pl-4">'+t.fnsattelite+"</div></div>"};
