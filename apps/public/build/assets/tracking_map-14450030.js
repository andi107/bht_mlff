import{_ as F}from"./leaflet.rotatedMarker-71d1d069.js";import"./leaflet-svg-shape-markers-8f7f1e58.js";import"./_commonjsHelpers-28e086c5.js";const R=window.burl;var I=$("#tbllogsdet").DataTable({dom:"Bfrtip",buttons:[{extend:"copy"},{extend:"pdf"},{extend:"print"},{extend:"excel"}],scrollX:!0,order:[[0,"desc"]]});$("#tbllogsdet").width("100%");var _,g,b,e=L.map("trackingmap",{minZoom:5,fullscreenControl:!0,attributionControl:!1}).setView([.33995192349439596,120.3733680354565],5),T=L.tileLayer(window.mapLayer);T.addTo(e);var d,u,l=[],m=[],h,w=[];$("#formMapTrack").submit(function(r){r.preventDefault(),_=$("input[name=device_id]").val(),g=$("input[name=txtdtfrom]").val(),b=$("input[name=txtdtto]").val(),l=[],m=[],d&&(e.removeLayer(d),e.removeLayer(u)),f&&clearInterval(f),I.clear().draw(),$.get(R+`/tracking/detail/js/map?did=${_}&from=${g}&to=${b}&humanTz=${window.dtHumanName()}`,function(t){$.each(t.relay.data,function(n,a){l.push({type:"Feature",properties:{created_at:a.created_at,ffaccuracy_cep:a.ffaccuracy_cep,ffaltitude:a.ffaltitude,ffbattery:a.ffbattery,ffdirection:a.ffdirection,fflat:a.fflat,fflon:a.fflon,ffspeed:a.ffspeed},geometry:{type:"Point",coordinates:[parseFloat(a.fflon),parseFloat(a.fflat)]}}),m.push([parseFloat(a.fflon),parseFloat(a.fflat)])}),$.each(t.relay.geo_gate,function(n,a){w.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[a.polygon]}})}),t.relay.data.length!=0?(A(),C(),x(),P()):toastr.info("Vehicle tracking not found.","Information")})});function A(){var r=new L.featureGroup([]),t={type:"FeatureCollection",name:"relay",features:l};function n(){return{pane:"pane_Relay",shape:"circle",radius:4,opacity:1,color:"#CF0A0A",dashArray:"",lineCap:"butt",lineJoin:"miter",weight:1,fill:!0,fillOpacity:1,fillColor:"#FF0032",interactive:!0}}function a(v,s){var o=v.properties,c="n/a";y(parseInt(o.fnsignal),0,10)?c="Poor":y(parseInt(o.fnsignal),11,20)?c="Good":y(parseInt(o.fnsignal),21,31)&&(c="Excelent");var k='<h3 class="h6 text-center d-block text-uppercase font-weight-bold">INFO</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">DATE TIME</div><div class="col-7 pl-4">'+window.dtHumanParse(o.created_at)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ALT (Meters)</div><div class="col-7 pl-4">'+parseFloat(parseFloat(o.ffaltitude)/3.2808).toFixed(2)+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SPEED</div><div class="col-7 pl-4">'+o.ffspeed+'Km/h</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">ACCURACY (CEP)</div><div class="col-7 pl-4">'+o.ffaccuracy_cep+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SIGNAL</div><div class="col-7 pl-4">'+o.fnsignal+" ("+c+')</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">DIRECTION</div><div class="col-7 pl-4">'+o.ffdirection+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">COORDINATE</div><div class="col-7 pl-4">'+o.fflat.toString()+", "+o.fflon.toString()+'</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">SATTELITE</div><div class="col-7 pl-4">'+o.fnsattelite+"</div></div>";s.bindPopup(k,{maxHeight:400}),s.bindTooltip(window.dtHumanParse(o.created_at)).openTooltip()}e.createPane("pane_Relay"),e.getPane("pane_Relay").style.zIndex=402,e.getPane("pane_Relay").style["mix-blend-mode"]="normal",d=new L.geoJson(t,{attribution:"",interactive:!0,dataVar:"jRelay",layerName:"lRelay",pane:"pane_Relay",onEachFeature:a,pointToLayer:function(v,s){return L.shapeMarker(s,n())}}),r.addLayer(d),e.addLayer(d),e.fitBounds(r.getBounds())}function C(){var r={type:"FeatureCollection",name:"line_relay",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m}}]};function t(n){return{pane:"pane_line_relay",opacity:1,color:"#FF0032",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:1,fillOpacity:0,interactive:!0}}e.createPane("pane_line_relay"),e.getPane("pane_line_relay").style.zIndex=401,e.getPane("pane_line_relay").style["mix-blend-mode"]="normal",u=new L.geoJson(r,{attribution:"",interactive:!0,dataVar:"json_line_relay",layerName:"layer_line_relay",pane:"pane_line_relay",style:t}),e.addLayer(u)}function P(){var r={type:"FeatureCollection",name:"polyGates",features:w};function t(n){return{pane:"pane_polyGates",opacity:1,color:"#8F43EE",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:2,fillOpacity:0,interactive:!0}}e.createPane("pane_polyGates"),e.getPane("pane_polyGates").style.zIndex=401,e.getPane("pane_polyGates").style["mix-blend-mode"]="normal",h=new L.geoJson(r,{attribution:"",interactive:!0,dataVar:"json_polyGates",layerName:"layer_polyGates",pane:"pane_polyGates",style:t}),e.addLayer(h)}function y(r,t,n){return r>=t&&r<=n}var i,p=0,f;function x(){p=0;var r=l[0];i&&e.removeLayer(i),i=new F([r.geometry.coordinates[1],r.geometry.coordinates[0]],{draggable:!1,riseOnHover:!0,icon:L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[0,-15]})}).addTo(e),f=setInterval(function(){var t=l[p];i.slideTo([t.geometry.coordinates[1],t.geometry.coordinates[0]],{duration:1e3,keepAtCenter:!1}),i.setIcon(L.icon({iconUrl:window.c_marker_top,iconSize:window.c_marker_top_cfg[0],iconAnchor:window.c_marker_top_cfg[1],tooltipAnchor:[16,0]})),i.setRotationAngle(t.properties.ffdirection),i.setRotationOrigin("center center"),i.bindTooltip(`Speed: ${t.properties.ffspeed} Km/h`,{position:"bottom"}),i.openTooltip(),p++,p===l.length&&(clearInterval(f),x())},1e3)}
