import{_ as c}from"./leaflet.rotatedMarker-71d1d069.js";import"./_commonjsHelpers-28e086c5.js";const p=window.burl,l="/assets/images/leaflet/yellow-car40px.png",u="/assets/images/leaflet/yellow-car-top.png",m=window.sio;var n=L.map("devicesmap",{minZoom:5,attributionControl:!1,fullscreenControl:!0}).setView([.33995192349439596,120.3733680354565],5),d=new L.FeatureGroup,t={},s=function(e){return L.icon({iconUrl:e,iconSize:[30,30],iconAnchor:[15,20]})},f=function(){return Math.floor(Math.random()*16777215).toString(16)},v=L.tileLayer(window.mapLayer,{attribution:""});v.addTo(n);var g=function(e){return`<h3 class="h6 d-block text-uppercase font-weight-bold">${e.ftdevice_name}</h3><span class="bottom-line d-block mx-auto mt-3 mb-4"></span><div class="row my-2 mx-auto"><div class="col text-right border-right border-dark">Last Update</div><div class="col-7 pl-4">${window.dtHumanParse(e.created_at)}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle ID</div><div class="col-7 pl-4">${e.ftasset_id}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark">Vehicle Name</div><div class="col-7 pl-4">${e.ftasset_name}</div></div><div class="row my-2 mx-auto"><div class="col-5 text-right border-right border-dark"></div>`};$.get(p+"/devtools/monitor/js/devices",function(e){$.each(e.data.data,function(o,i){var a=new c([i.fflat,i.fflon],{draggable:!1,title:"Resource location",alt:"Resource Location",riseOnHover:!0,icon:s(l)});a.bindTooltip(i.ftasset_id).openTooltip();var r=L.popup().setContent(g(i));a.bindPopup(r,{className:"custom-popup"}).openPopup(),t[i.ftdevice_id]=a,t[i.ftdevice_id].__pathColor=`#${f()}`,a.addTo(n),d.addLayer(a),d.addTo(n)}),e.data.data.length!=0?n.fitBounds(d.getBounds()):console.log("No Data"),h()});function h(){m.on("trx_device_data_rcv",function(e){var o=JSON.parse(e);if(typeof t[o.id]<"u"){var i={lat:o.lat,lng:o.lon},a=new L.Polyline([t[o.id]._latlng,i],{color:t[o.id].__pathColor,weight:5,opacity:.5,smoothFactor:1});a.addTo(n),t[o.id].slideTo([o.lat,o.lon],{duration:5e3,keepAtCenter:!1});var r=L.icon({iconUrl:u,iconSize:[15,30],iconAnchor:[7,16]});t[o.id].setIcon(r),t[o.id].setRotationAngle(o.direction),t[o.id].setRotationOrigin("center center"),t[o.id]._latlng=i,setTimeout(function(){t[o.id].setIcon(s(l)),t[o.id].setRotationAngle(0)},3e5),console.log(t[o.id])}})}
